var g=document.getElementById("taskForm"),d=document.getElementById("taskInput"),y=document.getElementById("queueList"),v=document.getElementById("popBtn"),k=document.getElementById("currentTask"),m=document.getElementById("fileInput"),h=document.getElementById("exportBtn"),o=[],l=0;function a(){y.innerHTML="",o.forEach(e=>{let t=document.createElement("li");t.textContent=`${e.desc}  \u2022  (${e.priority})`,y.appendChild(t)})}function u(){localStorage.setItem("taskQueue",JSON.stringify({queue:o,popCount:l}))}function E(){let e={version:1,tasks:o.map(c=>({id:c.id,desc:c.desc}))},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=`tasks-auto-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}h.addEventListener("click",()=>{let e={version:1,tasks:o.map(c=>({id:c.id,desc:c.desc}))},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=`tasks-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)});m.addEventListener("change",e=>{let t=e.target.files?.[0];if(!t)return;let s=new FileReader;s.onload=n=>{let c=n.target.result;try{let i=JSON.parse(c);if(i.version===1&&Array.isArray(i.tasks)){o=i.tasks.map(r=>({...r,priority:r.desc.length})),o.sort((r,p)=>p.priority-r.priority),a(),u(),m.value="";return}}catch{}c.split(/\r?\n/).forEach(i=>{let r=i.trim();r&&(o.some(p=>p.desc===r)||o.push({id:crypto.randomUUID(),desc:r,priority:r.length}))}),o.sort((i,r)=>r.priority-i.priority),a(),u(),m.value=""},s.readAsText(t)});g.addEventListener("submit",e=>{e.preventDefault();let t=d.value.trim();t&&(o.push({id:crypto.randomUUID(),desc:t,priority:t.length}),o.sort((s,n)=>n.priority-s.priority),d.value="",a(),u())});v.addEventListener("click",()=>{if(!o.length)return;let e=o.shift();k.textContent=`\u25B6 Now doing: ${e.desc}`,a(),l++,l%5===0&&E(),u()});var f=localStorage.getItem("taskQueue");if(f)try{let{queue:e,popCount:t}=JSON.parse(f);o=e,l=t,a()}catch(e){console.error("Failed to load saved state:",e)}a();document.addEventListener("keydown",e=>{e.key==="/"&&!e.ctrlKey&&!e.metaKey&&(e.preventDefault(),d.focus()),e.key==="n"&&!e.ctrlKey&&!e.metaKey&&document.activeElement!==d&&(e.preventDefault(),v.click())});
